function checkTerrain(e){switch(e){case 2:return!1;case 3:return!1;case 4:return!1;case 5:return!1;case 6:return!1;default:return!0}}function checkGems(e,t){for(var i=0;i<GAME.treasureMap.length;i++)GAME.treasureMap[i].col===e&&GAME.treasureMap[i].row===t&&0==GAME.treasureMap[i].collected&&(GAME.treasureMap[i].collected=!0,GAME.points+=GAME.treasureMap[i].points,scoreboard.innerHTML=GAME.points,GAME.gems++,console.log(GAME.gems),GAME.gems==GAME.treasureMap.length&&(GAME.begin=!1,resetSwitch=!0,document.getElementById("win").classList.add("active")))}!function(){function e(e){e instanceof Array?e.forEach(function(e){t(e)}):t(e)}function t(e){if(s[e])return s[e];var t=new Image;t.onload=function(){s[e]=t,r()&&a.forEach(function(e){e()})},s[e]=!1,t.src=e}function i(e){return s[e]}function r(){var e=!0;for(var t in s)s.hasOwnProperty(t)&&!s[t]&&(e=!1);return e}function n(e){a.push(e)}var s={},a=[];window.Resources={load:e,get:i,onReady:n,isReady:r}}();var GAME=GAME||{};GAME.points=0,GAME.gems=0,GAME.begin=!1,GAME.message="test message",GAME.lives=4,GAME.grid={width:800,height:640,cellWidth:32,cellHeight:32,cols:25,rows:20},GAME.tileMap=[1,1,1,1,1,1,1,8,7,7,7,9,1,1,8,7,9,1,1,1,1,1,1,8,7,1,5,2,6,1,1,1,1,8,9,1,1,1,1,1,1,1,1,5,2,6,1,1,1,8,1,3,2,2,1,1,1,1,1,1,1,1,10,7,11,1,1,5,2,2,2,2,6,1,1,1,1,3,4,1,5,2,6,1,1,1,10,7,7,9,1,1,2,2,2,2,2,4,1,1,1,1,1,1,5,2,2,2,2,6,1,8,7,7,1,1,1,3,2,2,2,2,1,1,1,1,1,1,5,2,2,2,2,2,4,1,1,7,7,11,1,1,1,3,2,2,4,1,10,7,11,1,1,3,2,2,2,2,4,1,1,1,8,7,9,1,1,1,1,3,4,1,1,8,7,7,11,1,1,3,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,7,9,1,1,1,1,1,1,1,10,11,1,1,1,5,6,1,1,1,1,10,7,11,1,1,9,1,1,1,1,1,5,6,1,8,7,11,1,5,2,2,6,1,1,8,7,7,7,11,1,1,1,1,1,1,5,2,2,1,1,8,9,1,2,2,2,2,6,1,1,8,7,9,1,1,1,1,1,5,2,2,2,2,6,1,1,1,1,3,2,2,2,4,1,1,1,1,1,1,10,1,1,5,2,2,2,2,2,4,1,10,11,1,1,3,2,4,1,1,1,1,5,6,1,8,1,1,3,2,2,2,2,1,1,10,7,9,1,1,1,1,1,1,1,1,5,2,2,1,1,1,1,1,3,2,2,4,1,1,8,9,1,1,1,1,1,1,1,1,5,2,2,2,6,1,7,11,1,1,1,1,1,1,1,1,1,5,2,6,1,1,1,1,1,2,2,2,2,2,1,7,7,11,1,1,1,1,1,1,1,5,2,2,2,6,1,1,5,2,2,2,2,2,4,1,1,1,1,1,1,1,1,1,1,5,2,2,2,2,4,1,1,3,2,2,2,2,4,1,1,2,2,6,1,5,6,1,1,1,3,2,2,2,4,1,1,1,1,3,2,4,1,1,1,10,2,2,2,2,2,2,6,1,1,1,1,1,1,1,1,10,11,1,1,1,1,1,10,7,7],GAME.tileImages=["images/grass-block.png","images/grass-block.png","images/water-block.png","images/water-corner-bottomleft.png","images/water-corner-bottomright.png","images/water-corner-topleft.png","images/water-corner-topright.png","images/stone-block.png","images/stone-corner-bottomleft.png","images/stone-corner-bottomright.png","images/stone-corner-topleft.png","images/stone-corner-topright.png"];var resetSwitch=!1,startGameBtn=document.getElementById("beginGameBtn"),restartGameBtn=document.getElementById("restartGameBtn"),scoreboard=document.getElementById("points"),beginGameMessage=document.getElementById("beginGame-message"),Sprite=function(e){this.sprite=e,this.x=0,this.y=0,this.height=0,this.width=0};Sprite.prototype.render=function(e){e&&e.drawImage(Resources.get(this.sprite),this.x,this.y)};var Enemy=function(){Sprite.call(this,"images/enemy-bug.png"),this.x=-503*Math.random(),this.y=GAME.grid.cellHeight*Math.floor(Math.random()*GAME.grid.cols),this.speed=300*Math.random()+100};Enemy.prototype=Object.create(Sprite.prototype),Enemy.prototype.constructor=Enemy,Enemy.prototype.update=function(e){this.x<GAME.grid.width?this.x+=e*this.speed:(this.x=-GAME.grid.cellWidth,this.speed=300*Math.random()+100,this.y=GAME.grid.cellHeight*Math.floor(Math.random()*GAME.grid.cols)),this.x<player.x+GAME.grid.cellWidth&&this.x+GAME.grid.cellWidth>player.x&&this.y<player.y+GAME.grid.cellHeight&&GAME.grid.cellHeight+this.y>player.y&&GAME.begin&&GAME.reset()};var Player=function(){Sprite.call(this,"images/char-boy.png"),this.resetX=GAME.grid.cellWidth*Math.floor(GAME.grid.cols/2),this.resetY=GAME.grid.cellHeight*Math.floor(GAME.grid.rows/2),this.x=this.resetX,this.y=this.resetY,this.lives=3,this.points=0,this.reset=function(){this.x=this.resetX,this.y=this.resetY,console.log("player reset")},this.handleInput=function(e){var t,i,r,n=this.x,s=this.y;switch(e){case"up":this.y>0&&(s-=GAME.grid.cellHeight,t=n/GAME.grid.cellWidth,i=s/GAME.grid.cellHeight,r=i*GAME.grid.cols+t,checkTerrain(GAME.tileMap[r])&&(this.y-=GAME.grid.cellHeight),checkGems(t,i));break;case"down":this.y<GAME.grid.cellHeight*(GAME.grid.rows-1)&&(s+=GAME.grid.cellHeight,t=n/GAME.grid.cellWidth,i=s/GAME.grid.cellHeight,r=i*GAME.grid.cols+t,checkTerrain(GAME.tileMap[r])&&(this.y+=GAME.grid.cellHeight),checkGems(t,i));break;case"left":this.x>0&&(n-=GAME.grid.cellWidth,t=n/GAME.grid.cellWidth,i=s/GAME.grid.cellHeight,r=i*GAME.grid.cols+t,checkTerrain(GAME.tileMap[r])&&(this.x-=GAME.grid.cellWidth),checkGems(t,i));break;case"right":this.x<GAME.grid.cellWidth*(GAME.grid.cols-1)&&(n+=GAME.grid.cellWidth,t=n/GAME.grid.cellWidth,i=s/GAME.grid.cellHeight,r=i*GAME.grid.cols+t,checkTerrain(GAME.tileMap[r])&&(this.x+=GAME.grid.cellWidth),checkGems(t,i))}}};Player.prototype=Object.create(Sprite.prototype),Player.prototype.constructor=Player;var Gem=function(e,t){Sprite.call(this,"images/Gem-Orange.png"),this.collected=!1,this.points=100,this.col=e,this.row=t,this.x=GAME.grid.cellWidth*e,this.y=GAME.grid.cellHeight*t};Gem.prototype=Object.create(Sprite.prototype),Gem.prototype.constructor=Player;var player=new Player;scoreboard.innerHTML=GAME.points,beginGameMessage.innerHTML=GAME.lives;var lives=document.getElementById("livesLeft");lives.innerHTML=GAME.lives;var allEnemies=[new Enemy,new Enemy,new Enemy,new Enemy,new Enemy,new Enemy,new Enemy,new Enemy,new Enemy,new Enemy];GAME.treasureMap=[new Gem(5,0),new Gem(0,15),new Gem(4,8),new Gem(7,19),new Gem(15,6),new Gem(17,9),new Gem(15,17),new Gem(22,1),new Gem(22,19),new Gem(23,13)],GAME.reset=function(){resetSwitch||(resetSwitch=!0,GAME.lives>1?(GAME.begin=!1,document.getElementById("beginGame").classList.add("active"),GAME.lives--,beginGameMessage.innerHTML=GAME.lives,lives.innerHTML=GAME.lives):(document.getElementById("gameOver").classList.add("active"),GAME.begin=!1,resetSwtich=!1),player.reset())},startGameBtn.addEventListener("click",function(e){GAME.begin=!0,resetSwitch=!1,document.getElementById("beginGame").classList.remove("active")}),restartGameBtn.addEventListener("click",function(e){GAME.begin=!0,resetSwitch=!1,document.getElementById("gameOver").classList.remove("active"),GAME.lives=3,GAME.points=0,GAME.gems=0,scoreboard.innerHTML=GAME.points,beginGameMessage.innerHTML=GAME.lives,lives.innerHTML=GAME.lives,GAME.treasureMap.forEach(function(e){e.collected=!1}),player.reset()}),document.addEventListener("keydown",function(e){var t={37:"left",38:"up",39:"right",40:"down"};player.handleInput(t[e.keyCode])});var GAME=GAME||{},Engine=function(e){function t(){var e=Date.now(),i=(e-c)/1e3;r(i),s(),c=e,l.requestAnimationFrame(t)}function i(){o(),c=Date.now(),t()}function r(e){n(e)}function n(e){allEnemies.forEach(function(t){t.update(e)})}function s(){var e,t,i=GAME.grid.height/GAME.grid.cellHeight,r=GAME.grid.width/GAME.grid.cellWidth;for(e=0;i>e;e++)for(t=0;r>t;t++){var n=GAME.tileImages[GAME.tileMap[t+r*e]];d.drawImage(Resources.get(n),t*GAME.grid.cellWidth,e*GAME.grid.cellHeight,GAME.grid.cellWidth,GAME.grid.cellHeight)}a()}function a(){GAME.treasureMap.forEach(function(e){e.collected||e.render(d)}),allEnemies.forEach(function(e){e.render(d)}),GAME.begin?player.render(d):GAME.reset()}function o(){}var c,g=e.document,l=e.window,h=g.getElementById("canvas"),d=h.getContext("2d");h.width=GAME.grid.width,h.height=GAME.grid.height,Resources.load(["images/grass-block.png","images/grass-block.png","images/water-block.png","images/stone-corner-topright.png","images/water-corner-bottomleft.png","images/water-corner-bottomright.png","images/water-corner-topleft.png","images/water-corner-topright.png","images/stone-block.png","images/stone-corner-bottomleft.png","images/stone-corner-bottomright.png","images/stone-corner-topleft.png","images/enemy-bug.png","images/char-boy.png","images/Gem-Orange.png"]),Resources.onReady(i),e.ctx=d}(this);